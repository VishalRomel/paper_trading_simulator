<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
</head>

<body>

	<div id = "container">
	</div>
	
  <script>

	let companies = ["AAL","AAPL","ABBV","ABNB","ABT","ACGL","ACN","ADBE","ADI","ADM","ADP","ADSK","AEE","AEP","AES","AFL","AIG","AIZ","AJG","AKAM","ALB", "ALGN", "ALK", "ALL", "ALLE","AMAT"];

	// Get a reference to the container div
	const container = document.getElementById("container");

	// Create 20 div elements with canvas elements inside
	for (let i = 1; i < companies.length; i++) {
		// Create a new div element
		const div = document.createElement("div");

		// Set the id attribute for the div
		div.id = "canvas" + i;

		// Create a H2 element
		const h2 = document.createElement("h2");
		h2.id = "h2" + i;
		h2.textContent = companies[i]

		// Append the H2 element to the div
		div.appendChild(h2);


		// Create a canvas element
		const canvas = document.createElement("canvas");
		canvas.id = "myChart" + i;

		// Append the canvas element to the div
		div.appendChild(canvas);

		// Append the div to the container
		container.appendChild(div);

		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
		axios.post('http://localhost:3000/av', {stock: companies[i-1]})
		.then(response => {
		// response.data contains response from API
			console.log(response.data)
			var data = response.data;
	
	
			
			// Extract labels and data 
			const labels = data.map(item => item.week);
			labels.reverse();
			const prices = data.map(item => item.price);
			prices.reverse();
	
			// Create chart data
			const chartData = {
			labels: labels,
			datasets: [
				{
				label: 'Weekly Stock Prices',
				data: prices,
				borderColor: 'rgb(75, 192, 192)',
				tension: 0.1
				}
			]
			};
	
			// Get canvas context
			const ctx = document.getElementById('myChart'+i).getContext('2d');
	
			// Create chart
			const myChart = new Chart(ctx, {
			type: 'line',
			data: chartData,
			options: {
				scales: {
				y: {
					beginAtZero: false
				}
				}
			}
			});
		});
		////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	}
  </script>

</body>
</html>